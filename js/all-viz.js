(function(){var commaFormat,filterData,percentFormat,renderBar,renderPie;percentFormat=d3.format(".0%");commaFormat=d3.format("0,000");d3.csv("data/ventures_by_decade.csv",function(data){var barGroup,chart,data_1960s,data_1970s,data_1980s,data_1990s,data_2000s,data_2010s,decadeTotal,drawDecade,e,h,height,margin,svg,totalData,w,width,x,xAxis,y,yAxis;totalData=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_total,freq:+e.freq_total,kind:e.kind})}return _results}();data_1960s=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_1960s,freq:+e.freq_1960s,kind:e.kind})}return _results}();data_1970s=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_1970s,freq:+e.freq_1970s,kind:e.kind})}return _results}();data_1980s=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_1980s,freq:+e.freq_1980s,kind:e.kind})}return _results}();data_1990s=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_1990s,freq:+e.freq_1990s,kind:e.kind})}return _results}();data_2000s=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_2000s,freq:+e.freq_2000s,kind:e.kind})}return _results}();data_2010s=function(){var _i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){e=data[_i];_results.push({name:e.name,value:+e.value_2010s,freq:+e.freq_2010s,kind:e.kind})}return _results}();decadeTotal=[{decade:"1960s",value:119},{decade:"1970s",value:494},{decade:"1980s",value:1310},{decade:"1990s",value:2147},{decade:"2000s",value:3341},{decade:"2010s",value:1233}];margin={top:30,right:0,bottom:30,left:0};w=500;h=300;width=w-margin.left-margin.right;height=h-margin.top-margin.bottom;x=d3.scale.ordinal().domain(decadeTotal.map(function(d){return d.decade})).rangeRoundBands([0,width],.25);y=d3.scale.linear().domain([0,3341]).range([height,0]);xAxis=d3.svg.axis().scale(x).orient("bottom");yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(commaFormat);svg=d3.select("#decades").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("display","block").classed("center",true);chart=svg.append("g").attr("transform","translate("+margin.left+", "+margin.top+")");chart.append("g").attr("class","x axis").attr("transform","translate(0, "+height+")").call(xAxis);barGroup=chart.selectAll(".bargroup").data(decadeTotal).enter().append("g").classed("bargroup",true);barGroup.append("rect").attr("class","decade_bar").attr("x",function(d){return x(d.decade)}).attr("y",function(d){return y(d.value)}).attr("width",x.rangeBand()).attr("height",function(d){return height-y(d.value)}).on("mouseenter",function(){return d3.select(this).transition().style("opacity",.3)}).on("mouseleave",function(){return d3.select(this).transition().style("opacity",1)}).on("click",function(){var decade=d3.select(this).datum().decade;drawDecade(decade);d3.select("#decade-caption").html("Ventures Founded in "+decade).style("opacity",0).transition().duration(600).style("opacity",1)});barGroup.append("text").attr("class","text-on-bar").attr("x",function(d){return x(d.decade)}).attr("text-anchor","middle").attr("dx",x.rangeBand()/2).attr("y",function(d){return y(d.value)}).attr("dy","-1.2em").text(function(d){return commaFormat(d.value)}).style("opacity",1);drawDecade=function(decade){var decadeData;if(decade==="total"){decadeData=totalData}if(decade==="1960s"){decadeData=data_1960s}if(decade==="1970s"){decadeData=data_1970s}if(decade==="1980s"){decadeData=data_1980s}if(decade==="1990s"){decadeData=data_1990s}if(decade==="2000s"){decadeData=data_2000s}if(decade==="2010s"){decadeData=data_2010s}renderBar({data:decadeData,kind:"legal",w:400,h:200,targetId:"#legal",margin:{top:0,right:30,bottom:30,left:160}});renderBar({data:decadeData,kind:"ind",w:400,h:200,targetId:"#ind",margin:{top:0,right:30,bottom:30,left:230}});renderPie({data:decadeData,kind:"status",w:200,h:200,targetId:"#status",margin:{top:0,right:0,bottom:30,left:0}})};drawDecade("total");d3.select("#show-total").on("click",function(){drawDecade("total");d3.select("#decade-caption").html("All Ventures").style("opacity",0).transition().duration(600).style("opacity",1)})});renderPie=function(param){var arc,chart,color,data,g,height,legends,pie,radius,svg,width;d3.select(param.targetId).select("svg").remove();data=filterData(param.kind,param.data);width=param.w-param.margin.left-param.margin.right;height=param.h-param.margin.top-param.margin.bottom;radius=Math.min(width,height)/2;color=d3.scale.ordinal().domain(data.map(function(d){return d.name})).range(["#adc1cd","#cccc99","#fff"]);arc=d3.svg.arc().outerRadius(radius-10).innerRadius(30);pie=d3.layout.pie().sort(null).value(function(d){return d.freq});svg=d3.select(param.targetId).append("svg").attr("width",param.w).attr("height",param.h);chart=svg.append("g").attr("transform","translate("+(width/2+param.margin.left)+", "+(height/2+param.margin.top)+")");g=chart.selectAll(".arc").data(pie(data)).enter().append("g").attr("class","arc");g.append("path").attr("d",arc).style("fill","white").transition().duration(400).style("fill",function(d){return color(d.data.name)});g.append("text").attr("transform",function(d){return"translate("+arc.centroid(d)+")"}).style("text-anchor","middle").text(function(d){if(d.data.freq>.03){return percentFormat(d.data.freq)}}).classed("text-on-bar",true).style("opacity",0).transition().duration(400).style("opacity",1);legends=svg.selectAll("g .legends").data(data).enter().append("g").classed("legends",true).attr("transform",function(d,i){return"translate("+(i*60+7)+", "+(param.h-25)+")"});legends.append("rect").attr("x",0).attr("y",0).attr("width",60).attr("height",20).style("fill",function(d){return color(d.name)}).style("stroke-dasharray","60, 20, 60, 20").style("stroke","lightgray").style("stroke-width","0.5");legends.append("text").attr("text-anchor","middle").attr("x",30).attr("y",10).attr("dy",".3em").classed("text-on-bar",true).text(function(d){return d.name})};renderBar=function(param){var barGroup,chart,data,height,svg,width,x,xAxis,y,yAxis;d3.select(param.targetId).select("svg").remove();data=filterData(param.kind,param.data);width=param.w-param.margin.left-param.margin.right;height=param.h-param.margin.top-param.margin.bottom;x=d3.scale.linear().domain([0,d3.max(data,function(d){return d.freq})]).range([0,width]);y=d3.scale.ordinal().domain(data.map(function(d){return d.name})).rangeRoundBands([0,height],.1);xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(percentFormat).ticks(3);yAxis=d3.svg.axis().scale(y).orient("left");svg=d3.select(param.targetId).append("svg").attr("width",width+param.margin.left+param.margin.right).attr("height",height+param.margin.top+param.margin.bottom);chart=svg.append("g").attr("transform","translate("+param.margin.left+", "+param.margin.top+")");chart.append("g").attr("class","x axis").attr("transform","translate(0, "+height+")").call(xAxis);chart.append("g").attr("class","y axis").call(yAxis);barGroup=chart.selectAll(".bargroup").data(data).enter().append("g").classed("bargroup",true);barGroup.append("rect").attr("class","decade_small_bar").attr("y",function(d){return y(d.name)}).attr("height",y.rangeBand()).attr("width",0).transition().duration(400).attr("width",function(d){return x(d.freq)});barGroup.append("text").attr("class","text-on-bar").attr("x",function(d){return x(d.freq)}).attr("dx",".2em").attr("y",function(d){return y(d.name)}).attr("dy",y.rangeBand()/2).text(function(d){return commaFormat(d.value)}).style("opacity",0).transition().duration(400).style("opacity",1)};filterData=function(kind,data){var filteredData;filteredData=data.filter(function(d){return d.kind===kind});if(kind==="ind"){filteredData.sort(function(a,b){return b.value-a.value});filteredData=filteredData.filter(function(e){return e.name!=="Non-Profit"});filteredData=filteredData.filter(function(e,i){return i<=5})}return filteredData}}).call(this);
(function(){var draw_contrib;var colorScale=d3.scale.ordinal().domain(["Incorporated company","Partnership","Informal","Non-profit","Franchisee","Not reported","Sole proprietorship"]).range(["steelblue","slateblue","firebrick","orangered","darkgreen","gray","darkseagreen"]);draw_contrib=function(param){var commaFormat,dataJson,nodes,pack,radScale,svg,tooltip;commaFormat=d3.format("0,000");tooltip=d3.select("body").append("div").attr("class","map-tooltip").style("position","absolute");radScale=d3.scale.sqrt().domain(param.domainScale).range(param.rangeScale);pack=d3.layout.pack().sort(function(a,b){return b.value-a.value}).size([param.w,param.h]).value(function(d){return d.value}).padding(2).radius(function(d){return radScale(d)});svg=d3.select(param.idTarget).append("svg").attr("width",param.w).attr("height",param.h);dataJson=d3.nest().key(function(d){return d.name}).entries(param.contData[0]);dataJson.forEach(function(d){return d.children=d.values});nodes=pack.nodes({children:dataJson});svg.selectAll("circle").data(nodes).enter().append("circle").attr("r",function(d){return d.r}).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}).style("fill",function(d){if(d.children){return"white"}else{return colorScale(d.parent.key)}}).on("mouseover",function(d){if(!d.children){return tooltip.html(d.name+" <b>"+commaFormat(d.value)+"</b>").style("left",d3.event.pageX-15+"px").style("top",d3.event.pageY+50+"px").style("opacity",1)}}).on("mouseleave",function(d){return tooltip.style("opacity",0)})};d3.csv("data/all_vent_contrib.csv",function(dataCsv){var capData,d,empData,expData,revData;empData=[function(){var _i,_len,_results;_results=[];for(_i=0,_len=dataCsv.length;_i<_len;_i++){d=dataCsv[_i];_results.push({value:+d.employment,name:d.typorg})}return _results}()];revData=[function(){var _i,_len,_results;_results=[];for(_i=0,_len=dataCsv.length;_i<_len;_i++){d=dataCsv[_i];_results.push({value:+d.max_revenue,name:d.typorg})}return _results}()];expData=[function(){var _i,_len,_results;_results=[];for(_i=0,_len=dataCsv.length;_i<_len;_i++){d=dataCsv[_i];_results.push({value:+d.max_expend,name:d.typorg})}return _results}()];capData=[function(){var _i,_len,_results;_results=[];for(_i=0,_len=dataCsv.length;_i<_len;_i++){d=dataCsv[_i];_results.push({value:+d.max_capital,name:d.typorg})}return _results}()];draw_contrib({w:600,h:600,domainScale:[0,12e3],rangeScale:[0,30],idTarget:"#emp-dist",contData:empData});draw_contrib({w:600,h:600,domainScale:[0,15e9],rangeScale:[0,50],idTarget:"#rev-dist",contData:revData});draw_contrib({w:400,h:400,domainScale:[0,3e10],rangeScale:[0,60],idTarget:"#cap-dist",contData:capData});legend_data=["Incorporated company","Non-profit","Partnership","Sole proprietorship","Franchisee","Informal","Not reported"];legends=d3.select("#distrib-legends").append("svg").attr("width",250).attr("height",210).selectAll("g .legends").data(legend_data).enter().append("g").classed("legends",true).attr("transform",function(d,i){return"translate(0"+", "+i*20+")"});legends.append("rect").attr("x",200).attr("y",0).attr("width",50).attr("height",17).style("fill",function(d){return colorScale(d)});legends.append("text").attr("text-anchor","middle").attr("x",100).attr("y",10).attr("dy",".3em").style("fill","black").text(function(d){return d})})}).call(this);
(function(){var data,gradient,group,h,hMargin,svg,vMargin,w;data={rev:{lo:"1.2T",mi:"1.6 Trillion",hi:"2.0T"},exp:{lo:"0.7T",mi:"0.9 Trillion",hi:"1.1T"},emp:{lo:"1.7M",mi:"2.3 Million",hi:"2.9M"},ccap:{lo:"1.6T",mi:"2.1 Trillion",hi:"2.7T"},revVa:{lo:"294B",mi:"395 Billion",hi:"505B"},expVa:{lo:"208B",mi:"279 Billion",hi:"356B"},empVa:{lo:"278K",mi:"371 Thousand",hi:"477K"},ccapVa:{lo:"124B",mi:"167 Billion",hi:"213B"}};w=300;h=40;vMargin=40;hMargin=50;function draw_extrap(kind){svg=d3.select("#"+kind).append("svg:svg").attr("width",w+hMargin).attr("height",h+vMargin).attr("display","block").classed("center",true);gradient=svg.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","270%").attr("y2","50%").attr("spreadMethod","pad");gradient.append("svg:stop").attr("offset","0%").attr("stop-color","#fff").attr("stop-opacity",1);if(kind==="emp"||kind==="rev"||kind==="exp"||kind==="ccap"){gradient.append("svg:stop").attr("offset","100%").attr("stop-color","#235281").attr("stop-opacity",1)}else{gradient.append("svg:stop").attr("offset","100%").attr("stop-color","#CF7800").attr("stop-opacity",1)}group=svg.append("g").attr("transform","translate("+hMargin/2+", "+vMargin/2+")");group.append("svg:rect").attr("width",w).attr("height",h).style("fill","url(#gradient)");group.append("text").attr("text-anchor","middle").attr("x",0).attr("x","2em").attr("y",h/2).attr("dy",".5em").text(data[kind].lo);group.append("text").attr("text-anchor","middle").attr("x",0).attr("x","2em").attr("y",h).attr("dy",".8em").text("Low estimate");group.append("text").attr("text-anchor","middle").attr("x",w).attr("dx","-2em").attr("y",h/2).attr("dy",".5em").text(data[kind].hi);group.append("text").attr("text-anchor","middle").attr("x",w).attr("dx","-2em").attr("y",h).attr("dy",".8em").text("High estimate");group.append("text").attr("text-anchor","middle").attr("font-family","open sans").attr("font-size","30px").attr("font-variant","small-caps").attr("x",w/2).attr("y",h/2).attr("dy",".4em").text(data[kind].mi)}draw_extrap("emp");draw_extrap("rev");draw_extrap("exp");draw_extrap("ccap");draw_extrap("revVa");draw_extrap("expVa");draw_extrap("empVa");draw_extrap("ccapVa")}).call(this);
(function(){function draw_world(){var width=1050;var height=500;var centered;var tooltip=d3.select("body").append("div").attr("class","map-tooltip").style("position","absolute");var radius=d3.scale.sqrt().domain([1,100]).range([3,25]);var projection=d3.geo.equirectangular().translate([width/2,height/2+20]).scale(160).clipExtent([[0,0],[1050,450]]);var path=d3.geo.path().projection(projection);var svg=d3.select("#world-map").append("svg").attr("width",width).attr("height",height);svg.append("rect").attr("width",width).attr("height",height).attr("class","map-container").on("click",clicked);var g=svg.append("g");d3.json("data/world-110m.json",function(error,world){map_data=topojson.feature(world,world.objects.countries).features;d3.csv("data/ventures_by_country_id.csv",function(error,country_data){var country_len=country_data.length;var map_len=map_data.length;for(var i=0;i<country_len;i++){for(var j=0;j<map_len;j++){if(map_data[j].id==country_data[i].id){map_data[j].value=+country_data[i].value;map_data[j].lon=+country_data[i].lon;map_data[j].lat=+country_data[i].lat;map_data[j].name=country_data[i].name}}}filt_data=map_data.filter(function(d){return d.value});g.selectAll("circle").data(filt_data).enter().append("circle").attr("class","map-circle").attr("cx",function(d){return projection([d.lon,d.lat])[0]}).attr("cy",function(d){return projection([d.lon,d.lat])[1]}).attr("r",function(d){return radius(d.value)});g.selectAll("path").data(map_data).enter().append("path").attr("d",path).attr("class","country").on("mouseenter",function(d){if(d.value){name=d.name;value=d.value;tooltip.html(name+" <b>"+value+"</b>").style("left",d3.event.pageX-15+"px").style("top",d3.event.pageY+50+"px").style("opacity",1)}}).on("mouseleave",function(d){tooltip.style("opacity",0)}).on("click",clicked)})});function clicked(d){var x,y,k;if(d&&centered!==d){var centroid=path.centroid(d);x=centroid[0];y=centroid[1];k=4;centered=d}else{x=width/2;y=height/2;k=1;centered=null}g.selectAll("path").classed("active",centered&&function(d){return d===centered});g.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+k+")translate("+-x+","+-y+")").style("stroke-width",1.5/k+"px")}function zoom_out(){var x,y,k;x=width/2;y=height/2;k=1;centered=null;g.selectAll("path").classed("active",centered&&function(d){return d===centered});g.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+k+")translate("+-x+","+-y+")").style("stroke-width",1.5/k+"px")}d3.select("#zoom-text-world").html("Click on map to zoom in. Hover for details. &nbsp;&nbsp;");d3.select("#zoom-out-world").on("click",zoom_out)}draw_world();}).call(this);
(function(){var tooltip=d3.select("body").append("div").attr("class","map-tooltip").style("position","absolute");var w=800,h=600;var va_lon_lat=[-78.169968,37.769335];var svg=d3.select("#outstate").append("svg").attr("width",w).attr("height",h);var wScale=d3.scale.linear().domain([1,77]).range([1,15]);var cScale=d3.scale.linear().domain([1,77]).range(["#FFE4E4","#FC0000"]);var projection=d3.geo.albersUsa().translate([w/2,h/2]).scale([1e3]);var path=d3.geo.path().projection(projection);d3.json("data/us-states.json",function(json){d3.csv("data/outstate_va.csv",function(data){var data_len=data.length;var json_len=json.features.length;for(var i=0;i<data_len;i++){for(var j=0;j<json_len;j++){if(data[i].state==json.features[j].properties.name){json.features[j].properties.value=+data[i].value}}}svg.selectAll("line").data(data).enter().append("line").classed("outstate_line",true).attr("stroke","orange").transition().delay(function(d,i){return i*50}).duration(5e3).ease("linear").attr("stroke-width",function(d){return wScale(d.value)}).attr("x1",function(d){return projection([d.lon_state,d.lat_state])[0]}).attr("y1",function(d){return projection([d.lon_state,d.lat_state])[1]}).attr("x2",function(d){return projection(va_lon_lat)[0]}).attr("y2",function(d){return projection(va_lon_lat)[1]})});svg.selectAll("path").data(json.features).enter().append("path").attr("d",path).classed("state",function(d){if(d.properties.name==="Virginia"){return false}else{return true}}).attr("fill","steelblue").attr("stroke","black").classed("oustate",true).on("mouseenter",function(d){if(d.properties.value){name=d.properties.name;value=d.properties.value;tooltip.html(name+" <b>"+value+"</b>").style("left",d3.event.pageX-15+"px").style("top",d3.event.pageY+50+"px").style("opacity",1)}}).on("mouseleave",function(d){tooltip.style("opacity",0)})});}).call(this);
(function(){function draw_usmap(){var width=1050;var height=500;var centered;var tooltip=d3.select("body").append("div").attr("class","map-tooltip").style("position","absolute");var radius=d3.scale.sqrt().domain([1,600]).range([2,20]);var projection=d3.geo.albersUsa().translate([width/2,height/2]).scale(1e3);var path=d3.geo.path().projection(projection);var svg=d3.select("#us-map").append("svg").attr("width",width).attr("height",height);svg.append("rect").attr("width",width).attr("height",height).attr("class","map-container").on("click",clicked);var g=svg.append("g");d3.json("data/us-states.json",function(error,us_states){g.selectAll("path").data(us_states.features).enter().append("path").attr("class","state").attr("d",path).on("click",clicked);d3.csv("data/ventures_by_city_us.csv",type,function(error,city_data){city_data.sort(function(a,b){return b.value-a.value});g.selectAll("circle").data(city_data).enter().append("circle").attr("class","map-circle").attr("cx",function(d){return projection([d.lon,d.lat])[0]}).attr("cy",function(d){return projection([d.lon,d.lat])[1]}).attr("r",function(d){return radius(d.value)}).on("mouseover",function(d){desc=d.desc;value=d.value;tooltip.html(desc+" <b>"+value+"</b>").style("left",d3.event.pageX-15+"px").style("top",d3.event.pageY+50+"px").style("opacity",1);d3.select(this).style("fill","white")}).on("mouseleave",function(d){tooltip.style("opacity",0);d3.select(this).style("fill","orange")}).on("click",clicked)})});function clicked(d){var x,y,k;if(d&&centered!==d){if(d.type=="Feature"){var centroid=path.centroid(d);x=centroid[0];y=centroid[1]}else{x=projection([d.lon,d.lat])[0];y=projection([d.lon,d.lat])[1]}k=4;centered=d}else{x=width/2;y=height/2;k=1;centered=null}g.selectAll("path").classed("active",centered&&function(d){return d===centered});g.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+k+")translate("+-x+","+-y+")").style("stroke-width",1.5/k+"px")}function zoom_out(){var x,y,k;x=width/2;y=height/2;k=1;centered=null;g.selectAll("path").classed("active",centered&&function(d){return d===centered});g.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+k+")translate("+-x+","+-y+")").style("stroke-width",1.5/k+"px")}d3.select("#zoom-text-us").html("Click on map to zoom in. Hover for details. &nbsp;&nbsp;");d3.select("#zoom-out-us").on("click",zoom_out)}function type(d){d.value=+d.value;d.lon=+d.lon;d.lat=+d.lat;return d}draw_usmap();}).call(this);
(function(){function draw_vamap(){var width=1050;var height=500;var centered;var tooltip=d3.select("body").append("div").attr("class","map-tooltip").style("position","absolute");var radius=d3.scale.sqrt().domain([1,600]).range([2,40]);var projection=d3.geo.mercator().translate([width/2,height/2]).scale(6500).center([-79.4,37.968]);var path=d3.geo.path().projection(projection);var svg=d3.select("#va-map").append("svg").attr("width",width).attr("height",height);svg.append("rect").attr("width",width).attr("height",height).attr("class","map-container").on("click",clicked);var g=svg.append("g");d3.json("data/va.geo.json",function(error,virginia){g.selectAll("path").data(virginia.features).enter().append("path").attr("class","state").attr("d",path).on("click",clicked);d3.csv("data/ventures_by_city_va.csv",type,function(error,city_data){city_data.sort(function(a,b){return b.value-a.value});g.selectAll("circle").data(city_data).enter().append("circle").attr("class","map-circle").attr("cx",function(d){return projection([d.lon,d.lat])[0]}).attr("cy",function(d){return projection([d.lon,d.lat])[1]}).attr("r",function(d){return radius(d.value)}).on("mouseover",function(d){desc=d.desc;value=d.value;tooltip.html(desc+" <b>"+value+"</b>").style("left",d3.event.pageX-15+"px").style("top",d3.event.pageY+50+"px").style("opacity",1);d3.select(this).style("fill","white")}).on("mouseleave",function(d){tooltip.style("opacity",0);d3.select(this).style("fill","orange")}).on("click",clicked)})});function clicked(d){var x,y,k;if(d&&centered!==d){if(d.type=="Feature"){x=width/2;y=height/2;k=1;centered=null}else{x=projection([d.lon,d.lat])[0];y=projection([d.lon,d.lat])[1];k=4;centered=d}}else{x=width/2;y=height/2;k=1;centered=null}g.selectAll("path").classed("active",centered&&function(d){return d===centered});g.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+k+")translate("+-x+","+-y+")").style("stroke-width",1.5/k+"px")}function zoom_out(){var x,y,k;x=width/2;y=height/2;k=1;centered=null;g.selectAll("path").classed("active",centered&&function(d){return d===centered});g.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+k+")translate("+-x+","+-y+")").style("stroke-width",1.5/k+"px")}d3.select("#zoom-text-va").html("Click on a circle to zoom in. Hover for details. &nbsp;&nbsp;");d3.select("#zoom-out-va").on("click",zoom_out)}function type(d){d.value=+d.value;d.lon=+d.lon;d.lat=+d.lat;return d}draw_vamap();}).call(this);
(function(){function draw_chart_which_alumni(param){var width=param.w-param.margin.left-param.margin.right;var filtered_data;var percent=d3.format(".0%");var y=d3.scale.ordinal();var x=d3.scale.linear().range([0,width]);var xAxis=d3.svg.axis().scale(x).orient("bottom").ticks(5,"%").tickFormat(percent);filtered_data=param.data.filter(function(d){return d.kind==param.kind});if(param.kind!=="demog"){filtered_data.sort(function(a,b){return a.freq_ent-b.freq_ent})}var height=filtered_data.length*40-param.margin.top-param.margin.bottom;var svg=d3.select(param.id).append("svg").attr("width",width+param.margin.left+param.margin.right).attr("height",height+param.margin.top+param.margin.bottom);var chart=svg.append("g").attr("transform","translate("+param.margin.left+","+param.margin.top+")");x.domain([0,d3.max(filtered_data.map(function(d){return d3.max([d.freq_ent,d.freq_nent])}))]);y.rangeRoundBands([0,height],.8,.1);var yAxis=d3.svg.axis().scale(y).orient("left");y.domain(filtered_data.map(function(d){return d.name}));chart.append("g").classed("x axis",true).attr("transform","translate(0, "+height+")").call(xAxis);chart.append("g").classed("y axis",true).call(yAxis);function render_bars(elements_to_select,class_to_apply,data_to_select){var group=chart.selectAll(elements_to_select).data(filtered_data).enter().append("g");group.append("line").classed(class_to_apply,true).classed("line-inside-chart",true).attr("x1","0").attr("y1",function(d){if(data_to_select==="freq_ent")return y(d.name);else return y(d.name)+10}).attr("x2",function(d){return x(d[data_to_select])}).attr("y2",function(d){if(data_to_select==="freq_ent")return y(d.name);else return y(d.name)+10});svg.on("mouseenter",function(){d3.selectAll(param.id+" .text-on-bar").transition().style("opacity",1)}).on("mouseleave",function(){d3.selectAll(param.id+" .text-on-bar").transition().style("opacity",0)});group.append("text").attr("class","text-on-bar").attr("x",function(d){return x(d[data_to_select])}).attr("dx",".4em").attr("y",function(d){if(data_to_select=="freq_ent")return y(d.name)-9;else return y(d.name)+y.rangeBand()/2}).attr("dy","1.2em").text(function(d){return percent(d[data_to_select])}).style("opacity",0)}render_bars("g .ent","ent","freq_ent");render_bars("g .nent","nent","freq_nent")}function type(d){d.freq_ent=+d.freq_ent;d.freq_nent=+d.freq_nent;return d}d3.csv("data/ent_vs_nent.csv",type,function(error,data){draw_chart_which_alumni({data:data,id:"#experience",kind:"experience",w:600,margin:{top:0,right:30,bottom:20,left:420}});draw_chart_which_alumni({data:data,id:"#field",kind:"field",w:500,margin:{top:0,right:30,bottom:20,left:150}});draw_chart_which_alumni({data:data,id:"#degree",kind:"degree",w:500,margin:{top:0,right:30,bottom:20,left:70}});draw_chart_which_alumni({data:data,id:"#demog",kind:"demog",w:400,margin:{top:0,right:30,bottom:20,left:200}});legend_data=["% of Entrepreneurial Alumni","% of Non-entrepreneurial Alumni"];legendColor=d3.scale.ordinal().domain(legend_data).range(["#235281","#adc1cd"]);legends=d3.select("#which-alum-legends").append("svg").attr("width",600).attr("height",30).selectAll("g .legends").data(legend_data).enter().append("g").classed("legends",true).attr("transform",function(d,i){return"translate("+i*300+", "+"0"+")"});legends.append("rect").attr("x",0).attr("y",0).attr("width",300).attr("height",30).style("fill",function(d){return legendColor(d)});legends.append("text").attr("text-anchor","middle").attr("x",150).attr("y",15).attr("dy",".3em").style("fill",function(d,i){if(i===1){return"black"}return"white"}).text(function(d){return d})});}).call(this);
(function(){function draw_chart_age(param){var width=param.w-param.margin.left-param.margin.right;var height=param.h-param.margin.top-param.margin.bottom;var x=d3.scale.linear().domain([24,84]).range([0,width]);var y=d3.scale.linear().domain([0,d3.max(param.data,function(d){return d3.max([d.ent,d.nent])})]).range([height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom").ticks(10);var yAxis=d3.svg.axis().scale(y).orient("left").ticks(4);var svg=d3.select(param.id).append("svg").attr("width",width+param.margin.left+param.margin.right).attr("height",height+param.margin.top+param.margin.bottom);var chart=svg.append("g").attr("transform","translate("+param.margin.left+","+param.margin.top+")");chart.append("g").attr("class","x axis").attr("transform","translate(0, "+height+")").call(xAxis);chart.append("g").attr("class","y axis").call(yAxis);function render_line(elements_to_select,class_to_apply,data_to_select){var area=d3.svg.area().x(function(d){return x(d.age)}).y0(height).y1(function(d){return y(d[data_to_select])}).interpolate("cardinal");var group=chart.append("path").datum(param.data).attr("class",class_to_apply).classed("area",true).attr("d",function(d){return area(d)});svg.on("mouseenter",function(){d3.selectAll(".ratio").transition().duration(500).style("opacity",1);d3.selectAll(".area").transition().duration(2e3).style("opacity","0.2")}).on("mouseleave",function(){d3.selectAll(".ratio").transition().duration(500).style("opacity",0);d3.selectAll(".area").transition().duration(2e3).style("opacity","0.9")})}render_line("path .nent","nent-area","nent");render_line("path .ent","ent-area","ent");chart.append("svg:text").text("Number of alumni").attr("class","axis-label").attr("transform","translate(-50,"+height/2+") rotate(-90)");chart.append("svg:text").text("Age of alumni").attr("class","axis-label").attr("transform","translate("+width/2+", "+height+")").attr("dy","3em");chart.append("svg:text").text("Non-entrepreneurs").attr("class","axis-label").attr("transform","translate(80, 120)");chart.append("svg:text").text("Entrepreneurs").attr("class","axis-label").attr("transform","translate(80, "+height+")").attr("dy","-2em");y_ratio=d3.scale.linear().domain([0,1]).range([height,0]);line=d3.svg.line().x(function(d){return x(d.age)}).y(function(d){return y_ratio(d.ratio)}).interpolate("cardinal");var yAxis_ratio=d3.svg.axis().scale(y_ratio).orient("right").ticks(5);chart.append("g").attr("transform","translate("+width+", 0)").attr("class","y axis").call(yAxis_ratio).classed("ratio",true).style("opacity",0);chart.append("svg:path").datum(param.data).attr("class","line").classed("ratio",true).attr("d",line).style("opacity",0);chart.append("text").text("Ratio of Entrepreneurs to Non-entrepreneurs").attr("class","axis-label").classed("ratio",true).attr("x",width-150).attr("y",30).style("opacity",0)}function type(d){d.age=+d.age;d.ent=+d.ent;d.nent=+d.nent;d.ratio=+d.ratio;return d}d3.csv("data/age.csv",type,function(error,data){draw_chart_age({data:data,id:"#age",w:500,h:300,margin:{top:20,right:60,bottom:40,left:60}})});}).call(this);
